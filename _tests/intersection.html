<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8" />
    <title>Collision Intersection Issue</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        body {
            padding: 1em;
            display: flex;
            justify-content: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin: 0 auto;
            gap: 1em;
            font-family: sans-serif;
        }
        canvas {
            background: hsl(0, 0%, 95%);
            display: block;
            transform-origin: top;
        }
        input {
            width: 4em;
            font-family: monospace;
        }
    </style>
</head>

<body>
    
    <div class="container">
        
        <canvas id="myCanvas" width="400" height="200"></canvas>
        
        <table>
            <tr>
                <td>
                    fps
                </td>
                <td>
                    &nbsp;
                    <input type="number" id="fpsInput" />
                </td>
            </tr>
            <tr>
                <td>
                    canvas.width
                </td>
                <td>
                    &nbsp;
                    <input type="number" id="canvasWidthInput" />
                </td>
            </tr>
            <tr>
                <td>
                    wall.width
                </td>
                <td>
                    &nbsp;
                    <input type="number" id="wallWidthInput" />
                </td>
            </tr>
            <tr>
                <td>
                    ball.radius
                </td>
                <td>
                    &nbsp;
                    <input type="number" id="ballRadiusInput" /> px
                </td>
            </tr>
            <tr>
                <td>
                    ball.xSpeed
                </td>
                <td>
                    &nbsp;
                    <input type="number" id="ballXSpeedInput" /> px / s
                </td>
            </tr>
        </table>
        
    </div>
    
    <script>
        // document.querySelector("canvas").style.scale = 1 / devicePixelRatio;
        
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");
        canvas.style.width  = canvas.width + "px";
        canvas.style.height = canvas.height + "px";
        
        let ball = {
            radius: 50,
            x: canvas.width / 2,
            y: canvas.height / 2,
            xSpeed: 50,
            xDir: Math.round(Math.random()) ? 1 : -1,
            move: function (elapsedFrameTime) {
                this.x += getPixelInTime(this.xSpeed, elapsedFrameTime) * this.xDir;
            },
            detectCollision: function () {
                let leftCollision  = this.x - this.radius <= leftWall.x + leftWall.width;
                let rightCollision = this.x + this.radius >= rightWall.x;
                if (leftCollision || rightCollision) {
                    this.xDir *= -1;
                }
            },
            draw: function () {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "hsl(0, 60%, 50%, 0.2)";
                ctx.strokeStyle = "hsl(0, 60%, 50%, 0.2)";
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            },
        };
        
        function getPixelInTime(pixelsPerSecond, elapsedFrameTime) {
            return elapsedFrameTime / 1000 * pixelsPerSecond;
        }
        
        let leftWall = {
            width: 50,
            height: canvas.height,
            x: 0,
            y: 0,
            draw: function () {
                ctx.beginPath();
                ctx.rect(this.x, this.y, this.width, this.height);
                ctx.fillStyle = "hsl(0, 0%, 0%, 0.05)";
                ctx.fill();
                ctx.closePath();
                ctx.beginPath(this.x + this.width, this.y);
                ctx.lineWidth = 1;
                ctx.moveTo(this.x + this.width - 1 + 0.5, this.y);
                ctx.lineTo(this.x + this.width - 1 + 0.5, this.y + this.height);
                ctx.strokeStyle = "hsl(0, 0%, 0%, 0.1)";
                ctx.stroke();
                ctx.closePath();
            },
        };
        
        let rightWall = {
            width: 50,
            height: canvas.height,
            x: canvas.width - 50,
            y: 0,
            draw: function () {
                ctx.beginPath();
                ctx.rect(this.x, this.y, this.width, this.height);
                ctx.fillStyle = "hsl(0, 0%, 0%, 0.05)";
                ctx.fill();
                ctx.closePath();
                ctx.beginPath(this.x, this.y);
                ctx.lineWidth = 1;
                ctx.moveTo(this.x + 0.5, this.y);
                ctx.lineTo(this.x + 0.5, this.y + this.height);
                ctx.strokeStyle = "hsl(0, 0%, 0%, 0.1)";
                ctx.stroke();
                ctx.closePath();
            },
        };
        
        let fps = 60, lastFrameTime = Date.now(), fpsInterval = 1000 / fps;
        
        function draw() {
            let currentFrameTime = Date.now();
            let elapsedFrameTime = currentFrameTime - lastFrameTime;
            if (elapsedFrameTime > fpsInterval ) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                leftWall.draw();
                rightWall.draw();
                ball.detectCollision();
                ball.move(elapsedFrameTime);
                ball.draw();
                lastFrameTime = currentFrameTime - (elapsedFrameTime % fpsInterval);
            }
            requestAnimationFrame(draw);
        }
        draw();
        
        UI: {
            document.addEventListener("DOMContentLoaded", () => {
                let fpsInput = document.querySelector("#fpsInput");
                let canvasWidthInput = document.querySelector("#canvasWidthInput");
                let wallWidthInput = document.querySelector("#wallWidthInput");
                let ballRadiusInput = document.querySelector("#ballRadiusInput");
                let ballXSpeedInput = document.querySelector("#ballXSpeedInput");
                canvasWidthInput.addEventListener("input", () => {
                    canvas.width = canvasWidthInput.valueAsNumber || 400;
                    canvas.style.width  = canvas.width + "px";
                    canvas.style.height = canvas.height + "px";
                    rightWall.width = wallWidthInput.valueAsNumber || 400;
                    rightWall.x = canvas.width - rightWall.width;
                });
                wallWidthInput.addEventListener("input", () => {
                    leftWall.width = wallWidthInput.valueAsNumber || 400;
                    rightWall.width = wallWidthInput.valueAsNumber || 400;
                    rightWall.x = canvas.width - rightWall.width;
                });
                fpsInput.addEventListener("input", () => {
                    fps = fpsInput.valueAsNumber || 60;
                    fpsInterval = 1000 / fps;
                });
                ballRadiusInput.addEventListener("input", () => {
                    ball.radius = ballRadiusInput.valueAsNumber || 50;
                });
                ballXSpeedInput.addEventListener("input", () => {
                    ball.xSpeed = ballXSpeedInput.valueAsNumber || 50;
                });
                fpsInput.value = fps;
                canvasWidthInput.value = canvas.width;
                wallWidthInput.value = leftWall.width;
                ballRadiusInput.value = ball.radius;
                ballXSpeedInput.value = ball.xSpeed;
            });
        }
    </script>
</body>

</html>